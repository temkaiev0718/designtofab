{% liquid 
  assign has_headings = false
  if section.settings.text != blank or section.settings.subtext != blank
    assign has_headings = true
  endif
%}

<style>
  @media screen and (min-width: 1000px) {
    .dac--heading-with-richtext .prose {
      display: flex;
      gap: 10%;
      --content-max-width: {{ section.settings.content_right_max_width }}%;
    }

    #shopify-section-{{ section.id }} .prose .column-right {
      margin-top: 0;
      width: {{ section.settings.content_right_max_width }}%;
      max-width: {{ section.settings.content_right_max_width }}%;
      {% unless has_headings %}margin: 0 auto;{% endunless %}
      position: relative;
      left: {{ section.settings.content_right_offset }}px;
    }
  }
</style>

{%- if section.blocks.size > 0 -%}
  {%- assign color_scheme_hash = section.settings.color_scheme.settings.background_gradient | default: section.settings.color_scheme.settings.background | md5 -%}

  <div class="color-scheme color-scheme--{{ section.settings.color_scheme.id }} color-scheme--bg-{{ color_scheme_hash }} {% unless section.settings.remove_vertical_spacing %}section-spacing{% endunless %} {% if section.settings.separate_section_with_border %}bordered-section{% endif %} {{ section.settings.custom_class }}">
    <div class="container container-main">
      <div class="container container--{{ section.settings.content_width }}">
        <div class="prose text-{{ section.settings.text_position }}">
          {%- assign is_inside_button_group_context = false -%}
  
          {%- if has_headings -%}
          <div class="column-left">
            {%- if section.settings.text != blank -%}
              <p class="{{ section.settings.heading_tag }}">{{ section.settings.text }}</p>
            {%- endif -%}
  
            {%- if section.settings.subtext != blank -%}
              <p style="margin-block-start: 1rem;">{{ section.settings.subtext }}</p>
            {%- endif -%}
          </div>
          {%- endif -%}
  
          <div class="column-right">
            {%- for block in section.blocks -%}
              {%- if block.type == 'button' and is_inside_button_group_context == false -%}
                {%- assign is_inside_button_group_context = true -%}
                <div class="button-group justify-{{ section.settings.text_position }}">
              {%- elsif block.type != 'button' and is_inside_button_group_context -%}
                {%- assign is_inside_button_group_context = false -%}
                </div>
              {%- endif -%}
  
              {%- case block.type -%}
                {%- when 'richtext' -%}
                  {%- if block.settings.content != blank -%}
                    <div class="block-item" {{ block.shopify_attributes }}>
                      {{- block.settings.content -}}
                    </div>
                  {%- endif -%}
  
                {%- when 'page' -%}
                  {%- if block.settings.page.content != blank -%}
                    <div {{ block.shopify_attributes }}>
                      {{- block.settings.page.content -}}
                    </div>
                  {%- endif -%}
  
                {%- when 'image' -%}
                  {%- if block.settings.image != blank -%}
                    <div {{ block.shopify_attributes }}>
                      {%- capture image_style_attribute -%}{% if section.settings.text_position == 'center' %}margin-inline: auto;{% elsif section.settings.text_position == 'end' %}margin-inline-start: auto;{% endif %}{%- endcapture -%}
  
                      {%- if block.settings.width_mode == 'custom' -%}
                        {%- capture image_style_attribute -%}{{ image_style_attribute }} --image-max-width: {{ block.settings.max_width }}px; --image-mobile-max-width: {{ block.settings.mobile_max_width }}px{%- endcapture -%}
                        {%- capture image_sizes_attribute -%}(max-width: 699px) min({{ block.settings.mobile_max_width }}px, 100vw), min({{ block.settings.max_width }}px, 100vw){%- endcapture -%}
                        {%- capture image_widths -%}{{ block.settings.mobile_max_width }},{{ block.settings.mobile_max_width | times: 2 }},{{ block.settings.max_width }},{{ block.settings.max_width | times: 2 }}{%- endcapture -%}
                      {%- else -%}
                        {%- capture image_sizes_attribute -%}min(100vw, var(--page-width)){%- endcapture -%}
                        {%- assign image_widths = '200,300,400,500,600,800,1000,1200,1400,1600' -%}
                      {%- endif -%}
  
                      {{- block.settings.image | image_url: width: block.settings.image.width | image_tag: sizes: image_sizes_attribute, widths: image_widths, class: 'constrained-image', style: image_style_attribute -}}
                    </div>
                  {%- endif -%}
  
                {%- when 'video' -%}
                  {%- if block.settings.video != blank -%}
                    <div {{ block.shopify_attributes }}>
                      {%- render 'media', media: block.settings.video, controls: true -%}
                    </div>
                  {%- endif -%}
  
                {%- when 'link' -%}
                  <a {% if block.settings.url %}href="{{ block.settings.url }}"{% endif %} class="link" {{ block.shopify_attributes }} {% if block.settings.new_window == true %} target="_blank" {% endif %}>{{ block.settings.text | escape }}</a>
  
                {%- when 'button' -%}
                  {%- if block.settings.text != blank -%}
                    {% render 'button', content: block.settings.text, href: block.settings.url, size: block.settings.size, style: block.settings.style, background: block.settings.background, text_color: block.settings.text_color, block: block %}
                  {%- endif -%}
  
                {%- when 'liquid' -%}
                  {%- if block.settings.liquid != blank -%}
                    <div class="block-item" {{ block.shopify_attributes }}>
                      {{- block.settings.liquid -}}
                    </div>
                  {%- endif -%}
              {%- endcase -%}
            {%- endfor -%}
          </div>
        </div>
      </div>
  
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Heading with Rich Text",
  "class": "shopify-section--rich-text dac--heading-with-richtext",
  "tag": "section",
  "disabled_on": {
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:global.colors.scheme",
      "default": "scheme-1"
    },
    {
      "type": "checkbox",
      "id": "separate_section_with_border",
      "label": "t:global.section.separate_section_with_border",
      "default": true
    },
    {
      "type": "select",
      "id": "content_width",
      "label": "t:global.sizes.content_width",
      "options": [
        {
          "value": "xs",
          "label": "t:global.sizes.x_small"
        },
        {
          "value": "sm",
          "label": "t:global.sizes.small"
        },
        {
          "value": "md",
          "label": "t:global.sizes.medium"
        },
        {
          "value": "lg",
          "label": "t:global.sizes.large"
        },
        {
          "value": "max-page",
          "label": "Max Page Width"
        }
      ],
      "default": "sm"
    },
    {
      "type": "inline_richtext",
      "id": "text",
      "label": "Heading",
      "default": "Heading"
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "Heading Tag",
      "options": [
        {
          "value": "h1",
          "label": "H1"
        },
        {
          "value": "h2",
          "label": "H2"
        },
        {
          "value": "h3",
          "label": "H3"
        },
        {
          "value": "h4",
          "label": "H4"
        },
        {
          "value": "h5",
          "label": "H5"
        },
        {
          "value": "h6",
          "label": "H6"
        }
      ],
      "default": "h1"
    },
    {
      "type": "inline_richtext",
      "id": "subtext",
      "label": "Sub Heading"
    },
    {
      "type": "select",
      "id": "sub_heading_tag",
      "label": "Sub Heading Tag",
      "options": [
        {
          "value": "h1",
          "label": "H1"
        },
        {
          "value": "h2",
          "label": "H2"
        },
        {
          "value": "h3",
          "label": "H3"
        },
        {
          "value": "h4",
          "label": "H4"
        },
        {
          "value": "h5",
          "label": "H5"
        },
        {
          "value": "h6",
          "label": "H6"
        }
      ],
      "default": "h4"
    },
    {
      "type": "select",
      "id": "text_position",
      "label": "t:global.position.content_position",
      "options": [
        {
          "value": "start",
          "label": "t:global.position.left"
        },
        {
          "value": "center",
          "label": "t:global.position.center"
        },
        {
          "value": "end",
          "label": "t:global.position.right"
        }
      ],
      "default": "center"
    },
    {
      "type": "checkbox",
      "id": "remove_vertical_spacing",
      "label": "t:global.spacing.remove_vertical_spacing",
      "default": false
    },
    {
      "type": "range",
      "id": "content_right_max_width",
      "label": "Content Right Max Width",
      "min": 20,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 60
    },
    {
      "type": "number",
      "id": "content_right_offset",
      "label": "Content Right Position Offset (px)",
      "default": 0,
      "info": "Use this setting to adjust the offset position of the content. Can be negative or positive."
    },
    {
      "type": "text",
      "id": "custom_class",
      "label": "Custom Class",
      "info": "Add a custom class to the section to be able to target it with custom CSS."
    }
  ],
  "blocks": [
    {
      "type": "richtext",
      "name": "t:sections.rich_text.blocks.paragraph.name",
      "settings": [
        {
          "type": "richtext",
          "id": "content",
          "label": "t:global.text.content",
          "default": "<p>Use this text to share information about your brand with your customers. Describe a product, share announcements, or welcome customers to your store.</p>"
        }
      ]
    },
    {
      "type": "page",
      "name": "t:sections.rich_text.blocks.page.name",
      "settings": [
        {
          "type": "page",
          "id": "page",
          "label": "t:sections.rich_text.blocks.page.page"
        }
      ]
    },
    {
      "type": "liquid",
      "name": "t:sections.rich_text.blocks.liquid.name",
      "settings": [
        {
          "type": "liquid",
          "id": "liquid",
          "label": "t:global.code.liquid",
          "default": "<p>Write custom Liquid code to include widget or dynamic code.</p>"
        }
      ]
    },
    {
      "type": "link",
      "name": "t:sections.image_with_text.blocks.link.name",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "t:global.text.text",
          "default": "Text"
        },
        {
          "type": "url",
          "id": "url",
          "label": "t:global.text.link"
        },
        {
          "type": "checkbox",
          "id": "new_window",
          "label": "Open link in new Window"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Heading with Text (DAC)",
      "category": "DAC Sections",
      "blocks": [
        {
          "type": "richtext"
        }
      ]
    }
  ]
}
{% endschema %}
